const express = require('express');
const router = express.Router();
var Cookies = require('cookies')

let xor_key = 'qovasd8wdx';

function xor_strings(data, key){
	let length = data.length;
	let new_key = key.repeat((length / 10) + 1);
	let ctxt = '';
	for (let i = 0; i < length; i++) {
		ctxt += String.fromCharCode(data[i].charCodeAt(0).toString(10) ^ new_key[i].charCodeAt(0).toString(10));
	}
	return ctxt;
}

router.get('/', (req, res) => res.render('homepage'));

router.get('/dashboard', (req, res) => {
    var cookies = new Cookies(req, res);
    //console.log(cookies.get('sid'));
    let data = cookies.get('sid').toString();
    let buff = new Buffer(data, 'base64');
    let sesh = buff.toString('ascii');
	let d2 = xor_strings(sesh, xor_key);
	buff = new Buffer(d2, 'base64');
	sesh = buff.toString('ascii');
	buff = new Buffer(sesh, 'base64');
	sesh = buff.toString('ascii');
    //console.log(sesh)
    if (sesh === 'admin@hotmail.com') { 
        res.render('admin');
    } else {
        res.render('dashboard');
    }
});


module.exports = router;
